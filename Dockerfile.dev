FROM golang:1.25.4-bookworm@sha256:e17419604b6d1f9bc245694425f0ec9b1b53685c80850900a376fb10cb0f70cb AS go


FROM node:25-bookworm@sha256:7478f3725ef76ce6ba257a6818ea43c5eb7eb5bd424f0c3df3a80ff77203305e

COPY --from=go /usr/local/go /usr/local/go

ARG uid
ARG gid

ENV CGO_ENABLED=0
ENV GOPATH="/go"
ENV GOCACHE="/go-cache"
ENV PATH="/go/bin:/usr/local/go/bin:$PATH"

RUN install -d --owner=${uid} --group=${gid} \
    /home/node/.npm \
    /go \
    /go-cache \
    /database

USER ${uid}:${gid}

WORKDIR /application
